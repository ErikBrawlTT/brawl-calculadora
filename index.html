<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Calculadora Brawl Stars</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    body { font-family: Arial; text-align: center; }
    #resultado { font-size: 20px; margin: 10px; }
    #counterBox { display: flex; justify-content: center; gap: 20px; margin: 20px; }
    .counter { font-size: 18px; }
  </style>
</head>
<body>
  <h1>Calculadora Brawl Stars</h1>

  <form id="calcForm">
    ğŸŸï¸ Brawl Pass: <input type="number" id="bpass"><br>
    ğŸ©µ Comunes: <input type="number" id="comunes"><br>
    ğŸ’š Raras: <input type="number" id="raras"><br>
    ğŸ’œ Ã‰picas: <input type="number" id="epicas"><br>
    â¤ï¸ MÃ­ticas: <input type="number" id="miticas"><br>
    ğŸŒŸ Legendarias: <input type="number" id="legendarias"><br>
    âš¡ Hipercarga: <input type="number" id="hipercarga"><br>
    ğŸ”¥ Maxeados: <input type="number" id="maxeados"><br><br>
    
    <button type="button" id="calcBtn">Calcular</button>
    <button type="button" id="clearBtn">Limpiar</button>
  </form>

  <p id="resultado">Valor total: 0 â‚¬</p>
  <canvas id="myChart" width="300" height="300"></canvas>

  <div id="counterBox">
    <div class="counter">ğŸ‘€ <span id="visitas">0</span></div>
    <div class="counter">ğŸ‘ <span id="likes">0</span></div>
    <div class="counter">ğŸ‘ <span id="dislikes">0</span></div>
  </div>

  <button onclick="sumarLike(event)">ğŸ‘ Like</button>
  <button onclick="sumarDislike(event)">ğŸ‘ Dislike</button>

  <script>
  // ğŸ”‘ Supabase config
  const SUPABASE_URL = "https://yvciudpdvylmplpbfobo.supabase.co";
  const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inl2Y2l1ZHBkdnlsbXBscGJmb2JvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU4ODE5MTksImV4cCI6MjA3MTQ1NzkxOX0.kzMHyDj2A1Df5P0qJVdXdol8gkmnxmELYmad9gQX_WI";
  const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  let chart;

  // ğŸ¯ Calcular
  function calcular() {
    const bpass = +document.getElementById("bpass").value || 0;
    const comunes = +document.getElementById("comunes").value || 0;
    const raras = +document.getElementById("raras").value || 0;
    const epicas = +document.getElementById("epicas").value || 0;
    const miticas = +document.getElementById("miticas").value || 0;
    const legendarias = +document.getElementById("legendarias").value || 0;
    const hipercarga = +document.getElementById("hipercarga").value || 0;
    const maxeados = +document.getElementById("maxeados").value || 0;

    const valores = {
      "ğŸŸï¸ Brawl Pass": bpass*10,
      "ğŸ©µ Comunes": comunes*2,
      "ğŸ’š Raras": raras*5,
      "ğŸ’œ Ã‰picas": epicas*10,
      "â¤ï¸ MÃ­ticas": miticas*12,
      "ğŸŒŸ Legendarias": legendarias*15,
      "âš¡ Hipercarga": hipercarga*20,
      "ğŸ”¥ Maxeados": maxeados*50
    };

    const total = Object.values(valores).reduce((a,b)=>a+b,0);
    document.getElementById("resultado").innerText = "Valor total: " + total + " â‚¬";

    const data = {
      labels: Object.keys(valores),
      datasets: [{
        data: Object.values(valores),
        backgroundColor:["#00FFFF","#00FF00","#FF00FF","#FFFF00","#FF4500","#00CFFF","#FF69B4","#FF0000"],
        borderWidth:2
      }]
    };

    if(chart) chart.destroy();
    const ctx = document.getElementById('myChart').getContext('2d');
    chart = new Chart(ctx,{type:'doughnut',data:data,options:{cutout:"70%"}});

    confetti();
  }

  // ğŸ§¹ Limpiar
  function limpiar(){
    document.getElementById("calcForm").reset();
    document.getElementById("resultado").innerText="Valor total: 0 â‚¬";
    if(chart) chart.destroy();
  }

  // ğŸ‘€ Contar visita
  async function contarVisita() {
    let { data, error } = await supabase.from("counters").select("value").eq("id","visitas").single();
    if(error) { console.error(error); return; }
    let nuevo = (data?.value || 0) + 1;
    await supabase.from("counters").update({value:nuevo}).eq("id","visitas");
    document.getElementById("visitas").innerText = nuevo;
  }

  // ğŸ‘ Like
  async function sumarLike(e) {
    e.preventDefault();
    let { data, error } = await supabase.from("counters").select("value").eq("id","likes").single();
    if(error) { console.error(error); return; }
    let nuevo = (data?.value || 0) + 1;
    await supabase.from("counters").update({value:nuevo}).eq("id","likes");
    document.getElementById("likes").innerText = nuevo;
  }

  // ğŸ‘ Dislike
  async function sumarDislike(e) {
    e.preventDefault();
    let { data, error } = await supabase.from("counters").select("value").eq("id","dislikes").single();
    if(error) { console.error(error); return; }
    let nuevo = (data?.value || 0) + 1;
    await supabase.from("counters").update({value:nuevo}).eq("id","dislikes");
    document.getElementById("dislikes").innerText = nuevo;
  }

  // ğŸ“¥ Cargar contadores al inicio
  async function cargarContadores() {
    let { data, error } = await supabase.from("counters").select("id,value");
    if(error) { console.error(error); return; }
    data.forEach(r=>{
      if(r.id==="visitas") document.getElementById("visitas").innerText=r.value;
      if(r.id==="likes") document.getElementById("likes").innerText=r.value;
      if(r.id==="dislikes") document.getElementById("dislikes").innerText=r.value;
    });
  }

  document.getElementById("calcBtn").addEventListener("click", calcular);
  document.getElementById("clearBtn").addEventListener("click", limpiar);

  document.addEventListener("DOMContentLoaded",()=>{
    contarVisita();
    cargarContadores();
  });
  </script>
</body>
</html>
