<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Calculadora Brawl Stars</title>
<link href="https://fonts.googleapis.com/css2?family=Bangers&family=Orbitron:wght@700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
<style>
body { margin:0; font-family:'Bangers',cursive; background:url('Personajes-Brawl-Stars.webp') no-repeat center center fixed; background-size:cover; color:white; text-align:center; position:relative; }
body::after { content:""; position:fixed; inset:0; background:rgba(0,0,0,0.6); backdrop-filter:blur(6px); z-index:0; }
.container { position:relative; z-index:1; display:flex; flex-direction:column; align-items:center; justify-content:center; min-height:100vh; padding:20px; }
h1 { font-size:3rem; margin-bottom:20px; display:flex; align-items:center; justify-content:center; gap:10px; color:transparent; background:linear-gradient(90deg,#00FFAA,#00CFFF,#FF00FF); -webkit-background-clip:text; }
h1 .diamond { animation: glow 3s infinite alternate; }
@keyframes glow { 0%{text-shadow:0 0 5px rgba(255,255,255,0.5);} 50%{text-shadow:0 0 15px rgba(255,255,255,1);} 100%{text-shadow:0 0 5px rgba(255,255,255,0.5);} }
form { background:rgba(0,0,0,0.5); border-radius:60px; padding:20px; max-width:600px; width:90%; margin-bottom:15px; display:flex; flex-direction:column; align-items:center; }
label { display:flex; justify-content:space-between; margin:8px 0; width:100%; }
input { width:100px; text-align:center; border:none; border-radius:8px; }
.buttons { display:flex; justify-content:center; gap:25px; margin-top:15px; flex-wrap:wrap; }
button { padding:10px 20px; border:none; border-radius:12px; font-family:'Bangers'; font-size:1.5rem; color:white; cursor:pointer; transition: transform .08s ease; }
button:active { transform: scale(0.97); }
#calcBtn { background:linear-gradient(90deg,#ff0080,#7928ca); }
#clearBtn { background:linear-gradient(90deg,#00CFFF,#0077FF); }
#shareBtn {
  background: linear-gradient(90deg,#00FFAA,#FF00FF);
  margin-top:20px;
  color:white;
  border:none;
  border-radius:12px;
  font-family:'Bangers';
  font-size:1.5rem;
  padding:10px 20px;
  cursor:pointer;
  animation: pulse 1.2s infinite alternate;
  transition: transform 0.2s ease;
}
@keyframes pulse { 0%{transform:scale(1);} 50%{transform:scale(1.1);} 100%{transform:scale(1);} }
.metric-container { display:flex; justify-content:center; gap:22px; margin-top:18px; flex-wrap:wrap; }
.metric { display:flex; flex-direction:column; align-items:center; gap:6px; font-family:'Orbitron',sans-serif; font-size:2rem; }
.metric .box { background:rgba(0,0,0,0.7); padding:8px 18px; border-radius:12px; min-width:70px; text-align:center; font-weight:700; user-select:none; transition:all 0.2s ease; cursor:pointer; }
.metric.visitas .box { border:2px solid #00CFFF; color:#00CFFF; box-shadow:0 0 10px #00CFFF,0 0 20px #00CFFF; }
.metric.likes .box { border:2px solid #39ff14; color:#39ff14; box-shadow:0 0 10px #39ff14,0 0 20px #39ff14; }
.metric.dislikes .box { border:2px solid #FF073A; color:#FF073A; box-shadow:0 0 10px #FF073A,0 0 20px #FF073A; }
canvas { margin-top:15px; max-width:400px; position:relative; }
#centerDiamond { position:absolute; top:43%; left:50%; transform:translate(-50%,-50%); display:none; }
#centerDiamond img { width:210px; height:210px; border-radius:50%; object-fit:contain; background:rgba(0,0,0,0.3); }
#resultado { margin:10px 0; font-size:2rem; font-family:'Bangers'; color:#00FF00; text-shadow:0 0 8px #00FF00,0 0 15px #00FF00; }
.fade { opacity:0; transition:opacity 0.3s; }
.show { opacity:1; transition:opacity 0.3s; }
</style>
</head>
<body>
<div class="container">
<h1><span class="diamond">ğŸ’</span> Calculadora Brawl Stars <span class="diamond">ğŸ’</span></h1>
<form id="calcForm" onsubmit="return false;">
  <label>ğŸŸï¸ Brawl Pass: <input type="number" min="0" id="bpass" value="0"></label>
  <label>ğŸ©µ Comunes: <input type="number" min="0" id="comunes" value="0"></label>
  <label>ğŸ’š Raras: <input type="number" min="0" id="raras" value="0"></label>
  <label>ğŸ’œ Ã‰picas: <input type="number" min="0" id="epicas" value="0"></label>
  <label>â¤ï¸ MÃ­ticas: <input type="number" min="0" id="miticas" value="0"></label>
  <label>ğŸŒŸ Legendarias: <input type="number" min="0" id="legendarias" value="0"></label>
  <label>âš¡ Hipercarga: <input type="number" min="0" id="hipercarga" value="0"></label>
  <label>ğŸ”¥ Maxeados: <input type="number" min="0" id="maxeados" value="0"></label>
</form>

<div id="resultado">Valor total: 0 â‚¬</div>

<div class="buttons">
  <button id="calcBtn">Calcular</button>
  <button id="clearBtn">Limpiar</button>
  <button id="shareBtn">ğŸ“¤ Compartir</button>
</div>

<div class="metric-container">
  <div class="metric visitas"><span class="icon">ğŸ‘€</span><div class="box" id="visitas-counter">0</div></div>
  <div class="metric likes"><span class="icon">ğŸ‘</span><div class="box" id="likes-counter">0</div></div>
  <div class="metric dislikes"><span class="icon">ğŸ‘</span><div class="box" id="dislikes-counter">0</div></div>
</div>

<div style="position:relative; display:inline-block;">
  <canvas id="myChart" width="400" height="400"></canvas>
  <div id="centerDiamond"><img id="brawlerImg" src="https://raw.githubusercontent.com/ErikBrawlTT/brawl-calculadora/main/Brawlers/elprimo.png" alt="Brawler"></div>
</div>

<script type="module">
import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

const supabase = createClient('https://ttkneykkrkbajymzsgcr.supabase.co','TU_ANON_KEY_AQUI');
const PAGE_ID='pagina1';
let chart;

/* Contadores animados */
function animateCounter(id,value){ const el=document.getElementById(id); let start=parseInt(el.innerText)||0; const duration=600,t0=performance.now(); function step(t){ const p=Math.min((t-t0)/duration,1); el.innerText=Math.floor(start+(value-start)*p); if(p<1)requestAnimationFrame(step);} requestAnimationFrame(step);}

/* Cargar mÃ©tricas */
async function cargarMetricas(){ const {data,error}=await supabase.from('metrics').select('visitas,likes,dislikes').eq('page_id',PAGE_ID).single(); if(!error && data){ animateCounter('visitas-counter',data.visitas); animateCounter('likes-counter',data.likes); animateCounter('dislikes-counter',data.dislikes); } }

/* Incrementar visitas */
async function incrementarVisita(){ await supabase.rpc('increment_visitas',{pid:PAGE_ID}); await cargarMetricas();}

/* AnimaciÃ³n valor total */
function incrementarValorAnimado(el,target){ let start=0,duration=800,t0=performance.now(); function step(t){ const p=Math.min((t-t0)/duration,1); el.innerText='Valor total: '+Math.floor(start+(target-start)*p)+' â‚¬'; if(p<1)requestAnimationFrame(step);} requestAnimationFrame(step);}

/* Confeti */
function lanzarConfeti(){ confetti({particleCount:150,spread:90,origin:{y:0.6}});}

/* Mostrar resultado */
function actualizarResultado(total){ const res=document.getElementById('resultado'); res.classList.remove('show'); res.classList.add('fade'); void res.offsetWidth; res.classList.remove('fade'); res.classList.add('show'); incrementarValorAnimado(res,total); lanzarConfeti();}

/* Calcular */
function calcular(){ 
  const ids=['bpass','comunes','raras','epicas','miticas','legendarias','hipercarga','maxeados'];
  const vals=ids.map(id=>Math.max(Number(document.getElementById(id).value)||0,0));
  const valores={"ğŸŸï¸ Brawl Pass":vals[0]*10,"ğŸ©µ Comunes":vals[1]*2,"ğŸ’š Raras":vals[2]*5,"ğŸ’œ Ã‰picas":vals[3]*10,"â¤ï¸ MÃ­ticas":vals[4]*12,"ğŸŒŸ Legendarias":vals[5]*15,"âš¡ Hipercarga":vals[6]*20,"ğŸ”¥ Maxeados":vals[7]*50};
  const total=Object.values(valores).reduce((a,b)=>a+b,0);
  actualizarResultado(total);
  const data={labels:Object.keys(valores),datasets:[{data:Object.values(valores),backgroundColor:["#00FFFF","#00FF00","#FF00FF","#FFFF00","#FF4500","#00CFFF","#FF69B4","#FF0000"],borderWidth:2}]};
  const config={type:'doughnut',data,options:{cutout:"70%",plugins:{legend:{display:true,position:'bottom'}}}};
  if(chart){chart.destroy();}
  chart=new Chart(document.getElementById('myChart').getContext('2d'),config);
  document.getElementById('centerDiamond').style.display="block";
  document.getElementById('myChart').scrollIntoView({behavior:'smooth',block:'center'});
}

/* Limpiar */
function limpiar(){ document.getElementById('calcForm').reset(); document.getElementById('resultado').innerText="Valor total: 0 â‚¬"; if(chart){chart.destroy(); chart=null;} document.getElementById('centerDiamond').style.display="none"; document.getElementById('calcForm').scrollIntoView({behavior:'smooth',block:'start'}); }

/* Compartir */
document.getElementById("shareBtn").addEventListener("click", async () => {
  const url = window.location.href;
  const text = "Mira cuÃ¡nto valen mis Brawlers en Brawl Stars!";
  if (navigator.share) {
    try {
      await navigator.share({ title: "Calculadora Brawl Stars", text, url });
    } catch (err) {
      console.log(err);
    }
  } else {
    alert("Tu navegador no soporta compartir nativo.");
  }
});

/* RotaciÃ³n Brawler central */
const brawlers = [
  "https://raw.githubusercontent.com/ErikBrawlTT/brawl-calculadora/main/Brawlers/elprimo.png",
  "https://raw.githubusercontent.com/ErikBrawlTT/brawl-calculadora/main/Brawlers/colt.png",
  "https://raw.githubusercontent.com/ErikBrawlTT/brawl-calculadora/main/Brawlers/nita.png",
  "https://raw.githubusercontent.com/ErikBrawlTT/brawl-calculadora/main/Brawlers/edgar.png",
  "https://raw.githubusercontent.com/ErikBrawlTT/brawl-calculadora/main/Brawlers/spike.png",
  "https://raw.githubusercontent.com/ErikBrawlTT/brawl-calculadora/main/Brawlers/penny.png",
  "https://raw.githubusercontent.com/ErikBrawlTT/brawl-calculadora/main/Brawlers/darryl.png",
  "https://raw.githubusercontent.com/ErikBrawlTT/brawl-calculadora/main/Brawlers/rico.png",
  "https://raw.githubusercontent.com/ErikBrawlTT/brawl-calculadora/main/Brawlers/mortis.png",
  "https://raw.githubusercontent.com/ErikBrawlTT/brawl-calculadora/main/Brawlers/bea.png"
];
let current = 0;
const brawlerImg = document.getElementById("brawlerImg");
setInterval(() => {
  current = (current + 1) % brawlers.length;
  brawlerImg.src = brawlers[current];
}, 3000);

/* InicializaciÃ³n mÃ©tricas */
(async () => {
  await incrementarVisita();
})();
</script>
</body>
</html>
