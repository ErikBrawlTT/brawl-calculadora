<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Calculadora Brawl Stars</title>
<link href="https://fonts.googleapis.com/css2?family=Bangers&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>

<!-- Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=GTM-5NWMXWTH"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'GTM-5NWMXWTH');
</script>

<style>
body {
  margin: 0;
  font-family: 'Bangers', cursive;
  background: url('Personajes-Brawl-Stars.webp') no-repeat center center fixed;
  background-size: cover;
  position: relative;
  color: white;
  text-align: center;
}
body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.6);
  backdrop-filter: blur(6px);
  z-index: 0;
}
.container {
  position: relative;
  z-index: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  min-height: 100vh;
  padding: 20px;
}

/* Título centrado con diamantes alineados */
h1 {
  font-size: 3rem;
  margin-bottom: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  background: linear-gradient(90deg, #00FFAA, #00CFFF, #FF00FF);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

/* Formulario */
form {
  background: rgba(0,0,0,0.5);
  border-radius: 20px;
  padding: 20px;
  max-width: 600px;
  width:90%;
  margin-bottom: 25px;
}
label{display:flex;justify-content:space-between;margin:8px 0;}
input{width:100px;text-align:center;border:none;border-radius:8px;}
.buttons{display:flex;justify-content:center;gap:25px;margin-top:15px;}
button{
  padding:10px 20px;
  border:none;
  border-radius:12px;
  font-family:'Bangers';
  font-size:1.5rem;
  color:white;
  cursor:pointer;
}
#calcBtn {background:linear-gradient(90deg,#ff0080,#7928ca);}
#clearBtn{background:linear-gradient(90deg,#00CFFF,#0077FF);}
#shareBtn{background:linear-gradient(90deg,#00FFAA,#FF00FF);margin-top:10px;}

#resultado{margin-top:10px;font-size:1.8rem;color:#00FFAA;}
.visitas{margin-top:10px;font-size:1.4rem;color:#FFD700;}
canvas{margin-top:15px;max-width:400px;}

/* Diamante central del donut */
.center-diamond{
  position:absolute;
  width:50px;
  height:50px;
  border-radius:8px;
  z-index:3;
  pointer-events:none;
  display:none;
  box-shadow: 0 0 15px #fff, 0 0 30px #fff;
}
@keyframes spinDiamond{
  0% { transform: rotateY(0deg); }
  100% { transform: rotateY(360deg); }
}
</style>
</head>
<body>
<div class="container">
  <h1>💎 Calculadora Brawl Stars 💎</h1>

  <form id="calcForm">
    <label>🎟️ Brawl Pass: <input type="number" id="bpass" value="0"></label>
    <label>🩵 Comunes: <input type="number" id="comunes" value="0"></label>
    <label>💚 Raras: <input type="number" id="raras" value="0"></label>
    <label>💜 Épicas: <input type="number" id="epicas" value="0"></label>
    <label>❤️ Míticas: <input type="number" id="miticas" value="0"></label>
    <label>🌟 Legendarias: <input type="number" id="legendarias" value="0"></label>
    <label>⚡ Hipercarga: <input type="number" id="hipercarga" value="0"></label>
    <label>🔥 Maxeados: <input type="number" id="maxeados" value="0"></label>
  </form>

  <div class="buttons">
    <button id="calcBtn">Calcular</button>
    <button id="clearBtn">Limpiar</button>
  </div>

  <button id="shareBtn">📤 Compartir</button>

  <div id="resultado">Valor total: 0 €</div>
  <div class="visitas">👀 Visitas: <span id="visitas">7.156</span></div>

  <canvas id="myChart" width="400" height="400"></canvas>
  <div id="centerDiamond" class="center-diamond"></div>
</div>

<script>
function lanzarConfeti() {
  const duration = 4000;
  const end = Date.now() + duration;
  (function frame() {
    confetti({
      particleCount: 10,
      startVelocity: 3,
      gravity: 0.25,
      spread: 360,
      ticks: 200,
      origin: { x: Math.random(), y: Math.random() * 0.4 },
      colors: ['#ff0000','#00ff00','#0000ff','#ffff00','#ff00ff','#00ffff']
    });
    if (Date.now() < end) requestAnimationFrame(frame);
  })();
}

function beep(freq){const ctx=new (AudioContext||webkitAudioContext)(),o=ctx.createOscillator(),g=ctx.createGain();o.type="square";o.frequency.value=freq;o.connect(g);g.connect(ctx.destination);g.gain.setValueAtTime(.15,ctx.currentTime);o.start();o.stop(ctx.currentTime+.15);}
function vibrar(ms=80){if(navigator.vibrate)navigator.vibrate(ms);}
function animateNumber(finalValue){
  const start=0,duration=2000,startTime=performance.now();
  function step(now){
    const p=Math.min((now-startTime)/duration,1);
    resultado.innerText="Valor total: "+Math.floor(start+(finalValue-start)*p)+" €";
    if(p<1)requestAnimationFrame(step);
  }
  requestAnimationFrame(step);
}

let chart;
function mostrarDiamante(color){
  const diamond = document.getElementById('centerDiamond');
  diamond.style.display = 'block';
  diamond.style.background = color;
  diamond.style.left = (myChart.offsetLeft + myChart.width/2 - 25) + 'px';
  diamond.style.top = (myChart.offsetTop + myChart.height/2 - 25) + 'px';
  diamond.style.animation = 'spinDiamond 2s linear infinite';
}

function calcular(){
  beep(600); vibrar(80);
  const valores={
    "🎟️ Brawl Pass":bpass.value*10,
    "🩵 Comunes":comunes.value*2,
    "💚 Raras":raras.value*5,
    "💜 Épicas":epicas.value*10,
    "❤️ Míticas":miticas.value*12,
    "🌟 Legendarias":legendarias.value*15,
    "⚡ Hipercarga":hipercarga.value*20,
    "🔥 Maxeados":maxeados.value*50
  };
  const total = Object.values(valores).reduce((a,b)=>a+b,0);
  animateNumber(total);

  const data={labels:Object.keys(valores), datasets:[{data:Object.values(valores),
    backgroundColor:["#00CFFF","#CCCCCC","#00FF00","#800080","#FF0000","#FFD700","#FF8C00","#FF1493"],
    borderColor:"#111",borderWidth:2}]};

  if(chart)chart.destroy();
  chart=new Chart(myChart.getContext("2d"),{type:"doughnut",data:data,options:{plugins:{legend:{labels:{color:'white'}}}}});

  // Diamante central
  const maxIndex = Object.values(valores).indexOf(Math.max(...Object.values(valores)));
  const maxColor = data.datasets[0].backgroundColor[maxIndex];
  mostrarDiamante(maxColor);

  lanzarConfeti();
}

function limpiar(){
  beep(400);vibrar(80);
  calcForm.reset();
  resultado.innerText="Valor total: 0 €";
  if(chart) chart.destroy();
  document.getElementById('centerDiamond').style.display = 'none';
}

function compartir(){
  beep(800);vibrar(120);
  if(navigator.share){
    navigator.share({title:"Calculadora Brawl Stars",text:"¡Mira mi cálculo!",url:location.href});
  }else{alert("Tu navegador no soporta compartir directamente.");}
}

calcBtn.onclick=e=>{e.preventDefault();calcular();}
clearBtn.onclick=e=>{e.preventDefault();limpiar();}
shareBtn.onclick=e=>{e.preventDefault();compartir();}

// Simulación visitas
let visitas = 7156;
setInterval(()=>{visitas++;document.getElementById('visitas').innerText=visitas;},5000);
</script>
</body>
</html>
