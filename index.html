<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Calculadora Brawl Stars</title>
<link href="https://fonts.googleapis.com/css2?family=Bangers&family=Orbitron:wght@700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
<style>
/* MantÃ©n aquÃ­ todo tu CSS existente intacto */
</style>
</head>
<body>
<div class="container">
<h1><span class="diamond">ğŸ’</span> Calculadora Brawl Stars <span class="diamond">ğŸ’</span></h1>
<form id="calcForm" onsubmit="return false;">
  <label>ğŸŸï¸ Brawl Pass: <input type="number" min="0" id="bpass" value="0"></label>
  <label>ğŸ©µ Comunes: <input type="number" min="0" id="comunes" value="0"></label>
  <label>ğŸ’š Raras: <input type="number" min="0" id="raras" value="0"></label>
  <label>ğŸ’œ Ã‰picas: <input type="number" min="0" id="epicas" value="0"></label>
  <label>â¤ï¸ MÃ­ticas: <input type="number" min="0" id="miticas" value="0"></label>
  <label>ğŸŒŸ Legendarias: <input type="number" min="0" id="legendarias" value="0"></label>
  <label>âš¡ Hipercarga: <input type="number" min="0" id="hipercarga" value="0"></label>
  <label>ğŸ”¥ Maxeados: <input type="number" min="0" id="maxeados" value="0"></label>
</form>

<div id="resultado">Valor total: 0 â‚¬</div>

<div class="buttons">
<button id="calcBtn">Calcular</button>
<button id="clearBtn">Limpiar</button>
</div>
<button id="shareBtn">ğŸ“¤ Compartir</button>

<div class="metric-container">
  <div class="metric visitas">
    <span class="icon">ğŸ‘€</span>
    <div class="box" id="visitas-counter">0</div>
  </div>
  <div class="metric likes">
    <span class="icon">ğŸ‘</span>
    <div class="box" id="likes-counter">0</div>
  </div>
  <div class="metric dislikes">
    <span class="icon">ğŸ‘</span>
    <div class="box" id="dislikes-counter">0</div>
  </div>
</div>

<div style="position:relative; display:inline-block;">
  <canvas id="myChart" width="400" height="400"></canvas>
  <div id="centerDiamond">
    <img id="brawlerImg" src="https://raw.githubusercontent.com/ErikBrawlTT/brawl-calculadora/main/Brawlers/elprimo.png" alt="Brawler">
  </div>
</div>

<script type="module">
import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'

const supabase = createClient(
  'https://ttkneykkrkbajymzsgcr.supabase.co',
  'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR0a25leWtrcmtiYWp5bXpzZ2NyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU5OTAyMjIsImV4cCI6MjA3MTU2NjIyMn0.Zsqy_PZ6K-3iTjh7nkTyH-7M9gOnSFHt4f0p9y_WPiE'
);

const PAGE_ID = 'pagina1';
let chart;

/* ===== Animaciones contadores ===== */
function animateCounter(id, value){
  const el = document.getElementById(id);
  let start = parseInt(el.innerText)||0;
  const end = Number(value)||0;
  const duration = 600;
  const t0 = performance.now();
  function step(t){
    const p = Math.min((t - t0)/duration,1);
    el.innerText = Math.floor(start + (end-start)*p);
    if(p<1) requestAnimationFrame(step);
  }
  requestAnimationFrame(step);
}

/* ===== Incrementar valor animado ===== */
function incrementarValorAnimado(el, target){
  let start = 0;
  const duration = 800;
  const t0 = performance.now();
  function step(t){
    const p = Math.min((t-t0)/duration,1);
    el.innerText = 'Valor total: '+Math.floor(start + (target-start)*p)+' â‚¬';
    if(p<1) requestAnimationFrame(step);
  }
  requestAnimationFrame(step);
}

/* ===== Mostrar resultado con fade y confeti diamante rebotando ===== */
function actualizarResultado(total){
  const resultadoEl = document.getElementById('resultado');
  
  // AnimaciÃ³n fade
  resultadoEl.classList.remove('show');
  resultadoEl.classList.add('fade');
  void resultadoEl.offsetWidth; // forzar reflow
  resultadoEl.classList.remove('fade');
  resultadoEl.classList.add('show');
  
  // Incremento animado del valor
  incrementarValorAnimado(resultadoEl, total);

  // Coordenadas del diamante central para confeti
  const diamond = document.getElementById('centerDiamond');
  const rect = diamond.getBoundingClientRect();
  const x = (rect.left + rect.width/2)/window.innerWidth;
  const y = (rect.top + rect.height/2)/window.innerHeight;

  const colors = ['#00FFFF','#00FF00','#FF00FF','#FFFF00','#FF4500','#00CFFF','#FF69B4','#FF0000'];

  // Disparar confeti en cascada con rebote y movimiento curvo
  const shots = 5;
  let delay = 0;
  for(let i=0;i<shots;i++){
    setTimeout(() => {
      confetti({
        particleCount: 50,
        spread: 100,
        startVelocity: 30 + i*5,
        gravity: 0.4 + i*0.05,
        ticks: 250,
        origin: { x, y },
        colors: colors,
        scalar: 1 + i*0.1,
        shapes: ['square'],
        rotate: () => Math.random() * 360,
        tilt: () => Math.random() * 30 - 15,
        drift: () => (Math.random() - 0.5) * 4,
        wobble: 15,
        decay: 0.9,
        random: true
      });
    }, delay);
    delay += 100;
  }
}

/* ===== Calcular ===== */
function calcular(){
  const ids = ['bpass','comunes','raras','epicas','miticas','legendarias','hipercarga','maxeados'];
  const valoresInput = ids.map(id => Math.max(Number(document.getElementById(id).value)||0,0));
  const valores = {
    "ğŸŸï¸ Brawl Pass": valoresInput[0]*10,
    "ğŸ©µ Comunes": valoresInput[1]*2,
    "ğŸ’š Raras": valoresInput[2]*5,
    "ğŸ’œ Ã‰picas": valoresInput[3]*10,
    "â¤ï¸ MÃ­ticas": valoresInput[4]*12,
    "ğŸŒŸ Legendarias": valoresInput[5]*15,
    "âš¡ Hipercarga": valoresInput[6]*20,
    "ğŸ”¥ Maxeados": valoresInput[7]*50
  };
  const total = Object.values(valores).reduce((a,b)=>a+b,0);
  actualizarResultado(total);

  const data = { labels: Object.keys(valores), datasets: [{ data: Object.values(valores), backgroundColor:["#00FFFF","#00FF00","#FF00FF","#FFFF00","#FF4500","#00CFFF","#FF69B4","#FF0000"], borderWidth:2 }]};
  const config = { type:'doughnut', data, options:{ cutout:"70%", plugins:{legend:{display:true,position:'bottom'}} }};
  if(chart) chart.destroy();
  chart = new Chart(document.getElementById('myChart').getContext('2d'), config);

  document.getElementById('centerDiamond').style.display="block";
  document.getElementById('myChart').scrollIntoView({behavior:'smooth', block:'center'});
}

/* ===== Limpiar ===== */
function limpiar(){
  document.getElementById("calcForm").reset();
  document.getElementById("resultado").innerText="Valor total: 0 â‚¬";
  if(chart) { chart.destroy(); chart = null; }
  document.getElementById("centerDiamond").style.display="none";
  document.getElementById("calcForm").scrollIntoView({behavior:'smooth', block:'start'});
}

/* ===== Brawler central animado ===== */
const brawlers = [
"https://raw.githubusercontent.com/ErikBrawlTT/brawl-calculadora/main/Brawlers/elprimo.png",
"https://raw.githubusercontent.com/ErikBrawlTT/brawl-calculadora/main/Brawlers/colt.png",
"https://raw.githubusercontent.com/ErikBrawlTT/brawl-calculadora/main/Brawlers/nita.png",
"https://raw.githubusercontent.com/ErikBrawlTT/brawl-calculadora/main/Brawlers/edgar.png",
"https://raw.githubusercontent.com/ErikBrawlTT/brawl-calculadora/main/Brawlers/spike.png",
"https://raw.githubusercontent.com/ErikBrawlTT/brawl-calculadora/main/Brawlers/penny.png",
"https://raw.githubusercontent.com/ErikBrawlTT/brawl-calculadora/main/Brawlers/darryl.png",
"https://raw.githubusercontent.com/ErikBrawlTT/brawl-calculadora/main/Brawlers/rico.png",
"https://raw.githubusercontent.com/ErikBrawlTT/brawl-calculadora/main/Brawlers/mortis.png",
"https://raw.githubusercontent.com/ErikBrawlTT/brawl-calculadora/main/Brawlers/bea.png"
];
let current = 0;
const brawlerImg = document.getElementById("brawlerImg");
setInterval(()=>{
  current = (current+1) % brawlers.length;
  brawlerImg.src = brawlers[current];
},3000);

/* ===== Eventos botones ===== */
document.getElementById("calcBtn").addEventListener("click",calcular);
document.getElementById("clearBtn").addEventListener("click",limpiar);

/* ===== InicializaciÃ³n ===== */
(async ()=>{
  // AquÃ­ puedes mantener la funciÃ³n incrementarVisita si quieres
})();
</script>
</body>
</html>
