<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Calculadora Brawl Stars</title>

<!-- Google Tag Manager -->
<script>
(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5NWMXWTH');
</script>
<!-- End Google Tag Manager -->

<link href="https://fonts.googleapis.com/css2?family=Bangers&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>

<style>
  body {
    margin: 0;
    font-family: 'Bangers', cursive;
    background: url('Personajes-Brawl-Stars.webp') no-repeat center center fixed;
    background-size: cover;
    position: relative;
    color: white;
    text-align: center;
  }
  body::after {
    content: "";
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.6);
    backdrop-filter: blur(6px);
    z-index: 0;
  }
  .container {
    position: relative;
    z-index: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    padding: 20px;
  }

  h1 {
    font-size: 3rem;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    background: linear-gradient(90deg, #00FFAA, #00CFFF, #FF00FF);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }

  form {
    background: rgba(0,0,0,0.5);
    border-radius: 20px;
    padding: 20px;
    max-width: 600px;
    width:90%;
    margin-bottom: 25px;
  }

  label{display:flex;justify-content:space-between;margin:8px 0;}
  input{width:100px;text-align:center;border:none;border-radius:8px;}

  .buttons{display:flex;justify-content:center;gap:25px;margin-top:15px;}
  button{padding:10px 20px;border:none;border-radius:12px;font-family:'Bangers';font-size:1.5rem;color:white;cursor:pointer;}
  #calcBtn {background:linear-gradient(90deg,#ff0080,#7928ca);}
  #clearBtn{background:linear-gradient(90deg,#00CFFF,#0077FF);}
  #shareBtn{background:linear-gradient(90deg,#00FFAA,#FF00FF);animation:pulse 1s infinite;margin-top:15px;}
  @keyframes pulse{0%{transform:scale(1)}50%{transform:scale(1.1)}100%{transform:scale(1)}}

  #resultado{margin-top:10px;font-size:1.8rem;color:#00FFAA;}
  .visitas{margin-top:10px;font-size:1.4rem;color:#FFD700;}
  canvas{margin-top:15px;max-width:400px;}

  /* Diamante central giratorio */
  #diamanteCentral {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%,-50%) rotate(0deg);
    width: 60px;
    height: 60px;
    pointer-events:none;
    z-index:2;
  }
</style>
</head>
<body>
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5NWMXWTH"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

<div class="container">
  <h1>ğŸ’ Calculadora Brawl Stars ğŸ’</h1>

  <form id="calcForm">
    <label>ğŸŸï¸ Brawl Pass: <input type="number" id="bpass" value="0"></label>
    <label>ğŸ©µ Comunes: <input type="number" id="comunes" value="0"></label>
    <label>ğŸ’š Raras: <input type="number" id="raras" value="0"></label>
    <label>ğŸ’œ Ã‰picas: <input type="number" id="epicas" value="0"></label>
    <label>â¤ï¸ MÃ­ticas: <input type="number" id="miticas" value="0"></label>
    <label>ğŸŒŸ Legendarias: <input type="number" id="legendarias" value="0"></label>
    <label>âš¡ Hipercarga: <input type="number" id="hipercarga" value="0"></label>
    <label>ğŸ”¥ Maxeados: <input type="number" id="maxeados" value="0"></label>
  </form>

  <div class="buttons">
    <button id="calcBtn">Calcular</button>
    <button id="clearBtn">Limpiar</button>
  </div>

  <button id="shareBtn">ğŸ“¤ Compartir</button>

  <!-- Valor total -->
  <div id="resultado">Valor total: 0 â‚¬</div>

  <!-- Visitas -->
  <div class="visitas">ğŸ‘€ Visitas: <span id="visitas">0</span></div>

  <!-- Donut grÃ¡fico -->
  <canvas id="myChart" width="400" height="400"></canvas>

  <!-- Diamante central -->
  <div id="diamanteCentral">ğŸ’</div>
</div>

<script>
// RotaciÃ³n diamante central
let angle = 0;
const diamanteCentral = document.getElementById("diamanteCentral");
function girarDiamante() {
  angle += 0.5; // velocidad de giro
  diamanteCentral.style.transform = `translate(-50%,-50%) rotate(${angle}deg)`;
  requestAnimationFrame(girarDiamante);
}
girarDiamante();

// ------------ Confeti lento
function lanzarConfeti() {
  const duration = 4000;
  const end = Date.now() + duration;
  (function frame() {
    confetti({
      particleCount: 10,
      startVelocity: 3,
      gravity: 0.25,
      spread: 360,
      ticks: 200,
      origin: { x: Math.random(), y: Math.random() * 0.4 },
      colors: ['#ff0000','#00ff00','#0000ff','#ffff00','#ff00ff','#00ffff']
    });
    if (Date.now() < end) requestAnimationFrame(frame);
  })();
}

// sonido + vibracion
function beep(freq){const ctx=new (AudioContext||webkitAudioContext)(),o=ctx.createOscillator(),g=ctx.createGain();o.type="square";o.frequency.value=freq;o.connect(g);g.connect(ctx.destination);g.gain.setValueAtTime(.15,ctx.currentTime);o.start();o.stop(ctx.currentTime+.15);}
function vibrar(ms=80){if(navigator.vibrate)navigator.vibrate(ms);}

// animaciÃ³n contador
function animateNumber(finalValue){
  const start=0,duration=2000,startTime=performance.now();
  function step(now){
    const p=Math.min((now-startTime)/duration,1);
    resultado.innerText="Valor total: "+Math.floor(start+(finalValue-start)*p)+" â‚¬";
    if(p<1)requestAnimationFrame(step);
  }
  requestAnimationFrame(step);
}

let chart;
function calcular(){
  beep(600); vibrar(80);

  const valores={
    "ğŸŸï¸ Brawl Pass":bpass.value*10,
    "ğŸ©µ Comunes":comunes.value*2,
    "ğŸ’š Raras":raras.value*5,
    "ğŸ’œ Ã‰picas":epicas.value*10,
    "â¤ï¸ MÃ­ticas":miticas.value*12,
    "ğŸŒŸ Legendarias":legendarias.value*15,
    "âš¡ Hipercarga":hipercarga.value*20,
    "ğŸ”¥ Maxeados":maxeados.value*50
  };
  const total = Object.values(valores).reduce((a,b)=>a+b,0);
  animateNumber(total);

  // colores violetas/rosados/arco
  const colors = ["#ff00ff","#ff66ff","#800080","#cc00ff","#9933ff","#00ccff","#00ffcc","#ff3399"];
  const data={labels:Object.keys(valores), datasets:[{data:Object.values(valores),
    backgroundColor:colors,
    borderColor:"#111",borderWidth:2}]};

  if(chart)chart.destroy();
  chart=new Chart(myChart.getContext("2d"),{type:"doughnut",data:data,options:{
    plugins:{legend:{labels:{color:'white'}}},
    cutout: "50%",
  }});

  // Diamante central color dominante
  const maxValor = Math.max(...Object.values(valores));
  const indexDominante = Object.values(valores).indexOf(maxValor);
  diamanteCentral.style.color = colors[indexDominante];

  lanzarConfeti();
}

function limpiar(){beep(400);vibrar(80);calcForm.reset();resultado.innerText="Valor total: 0 â‚¬";if(chart)chart.destroy(); diamanteCentral.style.color="white";}
function compartir(){beep(800);vibrar(120);if(navigator.share){navigator.share({title:"Calculadora Brawl Stars",text:"Â¡Mira mi cÃ¡lculo!",url:location.href});}else{alert("Tu navegador no soporta compartir directamente.");}}

calcBtn.onclick=e=>{e.preventDefault();calcular();}
clearBtn.onclick=e=>{e.preventDefault();limpiar();}
shareBtn.onclick=e=>{e.preventDefault();compartir();}

// ---------------- Contador de visitas con CountAPI
const visitasElemento = document.getElementById("visitas");
fetch("https://api.countapi.xyz/hit/brawl-calculadora.vercel.app/visitas")
  .then(res => res.json())
  .then(data => {
    visitasElemento.innerText = data.value.toLocaleString();
  })
  .catch(err => console.error("Error al obtener visitas:", err));
</script>
</body>
</html>
