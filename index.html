<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Calculadora Brawl Stars</title>
<link href="https://fonts.googleapis.com/css2?family=Bangers&family=Orbitron:wght@700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
<style>
/* Tu CSS original */
body { margin: 0; font-family: 'Bangers', cursive; background: url('Personajes-Brawl-Stars.webp') no-repeat center center fixed; background-size: cover; color: white; text-align: center; position: relative;}
body::after { content: ""; position: fixed; inset: 0; background: rgba(0,0,0,0.6); backdrop-filter: blur(6px); z-index: 0;}
.container { position: relative; z-index: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; padding: 20px;}
h1 { font-size: 3rem; margin-bottom: 20px; display: flex; align-items: center; justify-content: center; gap: 10px; color: transparent; background: linear-gradient(90deg, #00FFAA, #00CFFF, #FF00FF); -webkit-background-clip: text;}
h1 .diamond { animation: glow 3s infinite alternate;}
@keyframes glow {0% { text-shadow: 0 0 5px rgba(255,255,255,0.5); } 50% { text-shadow: 0 0 15px rgba(255,255,255,1); } 100% { text-shadow: 0 0 5px rgba(255,255,255,0.5);}}
form { background: rgba(0,0,0,0.5); border-radius: 60px; padding: 20px; max-width: 600px; width:90%; margin-bottom: 25px; display: flex; flex-direction: column; align-items: center;}
label { display:flex; justify-content:space-between; margin:8px 0; width:100%;}
input { width:100px; text-align:center; border:none; border-radius:8px;}
.buttons { display:flex; justify-content:center; gap:25px; margin-top:15px;}
button { padding:10px 20px; border:none; border-radius:12px; font-family:'Bangers'; font-size:1.5rem; color:white; cursor:pointer;}
#calcBtn {background:linear-gradient(90deg,#ff0080,#7928ca);}
#clearBtn{background:linear-gradient(90deg,#00CFFF,#0077FF);}
#shareBtn{ background:linear-gradient(90deg,#00FFAA,#FF00FF); margin-top:20px; animation:pulse 1s infinite;}
@keyframes pulse{0%{transform:scale(1)} 50%{transform:scale(1.1)} 100%{transform:scale(1)}}
#resultado { margin-top: 20px; font-size: 2rem; font-family: 'Bangers', cursive; padding: 10px 20px; background: rgba(0,0,0,0.7); border: 2px solid #00FF00; border-radius: 12px; color: #00FF00; text-shadow: 0 0 10px #00FF00, 0 0 20px #00FF00;}
.countersRow { display:flex; justify-content:center; gap:30px; margin:15px 0;}
.counterBox { display:flex; flex-direction:column; align-items:center;}
.counterBox span { font-family: 'Orbitron', sans-serif; font-size:2rem; padding:8px 18px; background: rgba(0,0,0,0.7); border-radius:12px; border:2px solid #00CFFF; color:#00CFFF; text-shadow:0 0 8px #00CFFF,0 0 15px #00CFFF; min-width: 70px; text-align: center;}
.counterBox button { font-size:28px; padding:6px 12px; margin-bottom:4px; cursor:pointer;}
canvas{ margin-top:15px; max-width:400px; position:relative;}
#centerDiamond { position: absolute; top: 43%; left: 50%; transform: translate(-50%, -50%); display: none;}
#centerDiamond img { width: 210px; height: 210px; border-radius: 50%; object-fit: contain; background: rgba(0,0,0,0.3);}
</style>
</head>
<body>
<div class="container">
<h1><span class="diamond">üíé</span> Calculadora Brawl Stars <span class="diamond">üíé</span></h1>
<form id="calcForm">
  <label>üéüÔ∏è Brawl Pass: <input type="number" id="bpass" value="0"></label>
  <label>ü©µ Comunes: <input type="number" id="comunes" value="0"></label>
  <label>üíö Raras: <input type="number" id="raras" value="0"></label>
  <label>üíú √âpicas: <input type="number" id="epicas" value="0"></label>
  <label>‚ù§Ô∏è M√≠ticas: <input type="number" id="miticas" value="0"></label>
  <label>üåü Legendarias: <input type="number" id="legendarias" value="0"></label>
  <label>‚ö° Hipercarga: <input type="number" id="hipercarga" value="0"></label>
  <label>üî• Maxeados: <input type="number" id="maxeados" value="0"></label>
</form>
<div class="buttons">
  <button id="calcBtn">Calcular</button>
  <button id="clearBtn">Limpiar</button>
</div>
<button id="shareBtn">üì§ Compartir</button>

<div class="countersRow">
  <div class="counterBox">üëÄ Visitas: <span id="visitas">0</span></div>
  <div class="counterBox"><button id="likeBtn">‚ù§Ô∏è</button>Likes: <span id="likes">0</span></div>
  <div class="counterBox"><button id="dislikeBtn">üëé</button>No me gusta: <span id="dislikes">0</span></div>
</div>

<div id="resultado">Valor total: 0 ‚Ç¨</div>
<div style="position:relative; display:inline-block;">
  <canvas id="myChart" width="400" height="400"></canvas>
  <div id="centerDiamond">
    <img id="brawlerImg" src="https://raw.githubusercontent.com/ErikBrawlTT/brawl-calculadora/main/Brawlers/elprimo.png" alt="Brawler">
  </div>
</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
// ---------------- Supabase ----------------
const SUPABASE_URL = "https://yvciudpdvylmplpbfobo.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inl2Y2l1ZHBkdnlsbXBscGJmb2JvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU4ODE5MTksImV4cCI6MjA3MTQ1NzkxOX0.kzMHyDj2A1Df5P0qJVdXdol8gkmnxmELYmad9gQX_WI";
const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

async function initCounterRow() {
  const { data, error } = await supabase.from("counters").select("*").eq("id","main").single();
  if (error || !data) {
    await supabase.from("counters").insert([{id:"main", visitas:0, likes:0, dislikes:0}]);
  }
}

async function cargarContadores() {
  const { data, error } = await supabase.from("counters").select("*").eq("id","main").single();
  if(!error && data){
    document.getElementById("visitas").innerText=data.visitas;
    document.getElementById("likes").innerText=data.likes;
    document.getElementById("dislikes").innerText=data.dislikes;
  }
}

async function sumarContador(tipo){
  const { data } = await supabase.from("counters").select(tipo).eq("id","main").single();
  const nuevo = (data[tipo]||0)+1;
  await supabase.from("counters").update({[tipo]:nuevo}).eq("id","main");
  document.getElementById(tipo).innerText = nuevo;
}

// ---------------- Confeti ----------------
function lanzarConfeti() {
  const duration = 4000;
  const end = Date.now() + duration;
  (function frame() {
    confetti({ particleCount: 10, startVelocity: 3, gravity: 0.25, spread: 360, ticks: 200, origin: { x: Math.random(), y: Math.random() * 0.4 }, colors: ['#ff00ff','#00ffff','#00ff00','#ffff00','#ff0000','#00CFFF'] });
    if (Date.now() < end) requestAnimationFrame(frame);
  })();
}

// ---------------- Sonido y vibraci√≥n ----------------
function beep(freq){const ctx=new (AudioContext||webkitAudioContext)(), o=ctx.createOscillator(), g=ctx.createGain(); o.type="square"; o.frequency.value=freq; o.connect(g); g.connect(ctx.destination); g.gain.setValueAtTime(.15,ctx.currentTime); o.start(); o.stop(ctx.currentTime+.15);}
function vibrar(ms=80){if(navigator.vibrate)navigator.vibrate(ms);}

// ---------------- Animar n√∫mero ----------------
function animateNumber(finalValue){
  const resultado = document.getElementById("resultado");
  const start=0,duration=2000,startTime=performance.now();
  function step(now){
    const p=Math.min((now-startTime)/duration,1);
    resultado.innerText="Valor total: "+Math.floor(start+(finalValue-start)*p)+" ‚Ç¨";
    if(p<1) requestAnimationFrame(step);
  }
  requestAnimationFrame(step);
}

// ---------------- Calcular ----------------
let chart;
function calcular(){
  beep(600); vibrar(80);
  const valores={
    "üéüÔ∏è Brawl Pass":parseInt(document.getElementById("bpass").value)||0*10,
    "ü©µ Comunes":parseInt(document.getElementById("comunes").value)||0*2,
    "üíö Raras":parseInt(document.getElementById("raras").value)||0*5,
    "üíú √âpicas":parseInt(document.getElementById("epicas").value)||0*10,
    "‚ù§Ô∏è M√≠ticas":parseInt(document.getElementById("miticas").value)||0*12,
    "üåü Legendarias":parseInt(document.getElementById("legendarias").value)||0*15,
    "‚ö° Hipercarga":parseInt(document.getElementById("hipercarga").value)||0*20,
    "üî• Maxeados":parseInt(document.getElementById("maxeados").value)||0*50
  };
  const total = Object.values(valores).reduce((a,b)=>a+b,0);
  animateNumber(total);
  document.getElementById("centerDiamond").style.display="block";
  const data = { labels:Object.keys(valores), datasets:[{data:Object.values(valores), backgroundColor:["#00FFFF","#00FF00","#FF00FF","#FFFF00","#FF4500","#00CFFF","#FF69B4","#FF0000"], borderWidth:2}]};
  const config = {type:'doughnut', data:data, options:{cutout:"70%", plugins:{legend:{display:true, position:'bottom'}}}};
  if(chart) chart.destroy();
  chart = new Chart(document.getElementById('myChart').getContext('2d'), config);
  lanzarConfeti();
  document.getElementById('myChart').scrollIntoView({behavior:'smooth', block:'center'});
}

// ---------------- Limpiar ----------------
function limpiar(){ document.getElementById("calcForm").reset(); document.getElementById("resultado").innerText="Valor total: 0 ‚Ç¨"; if(chart) chart.destroy(); document.getElementById("centerDiamond").style.display="none"; }

// ---------------- Compartir ----------------
document.getElementById("shareBtn").addEventListener("click", async () => {
  const url = window.location.href;
  const text = "Mira cu√°nto valen mis Brawlers en Brawl Stars!";
  if(navigator.share){ try{ await navigator.share({title:"Calculadora Brawl Stars", text, url}); } catch(err){console.log("Cancelado",err);} } 
  else alert("Tu navegador no soporta compartir nativo.");
});

// ---------------- Botones ----------------
document.getElementById("calcBtn").addEventListener("click",(e)=>{e.preventDefault(); calcular(); sumarContador("visitas");});
document.getElementById("clearBtn").addEventListener("click",(e)=>{e.preventDefault(); limpiar();});
document.getElementById("likeBtn").addEventListener("click",()=>sumarContador("likes"));
document.getElementById("dislikeBtn").addEventListener("click",()=>sumarContador("dislikes"));

// ---------------- Brawler central ----------------
const brawlers = [
"https://raw.githubusercontent.com/ErikBrawlTT/brawl-calculadora/main/Brawlers/elprimo.png",
"https://raw.githubusercontent.com/ErikBrawlTT/brawl-calculadora/main/Brawlers/colt.png",
"https://raw.githubusercontent.com/ErikBrawlTT/brawl-calculadora/main/Brawlers/nita.png",
"https://raw.githubusercontent.com/ErikBrawlTT/brawl-calculadora/main/Brawlers/edgar.png",
"https://raw.githubusercontent.com/ErikBrawlTT/brawl-calculadora/main/Brawlers/spike.png",
"https://raw.githubusercontent.com/ErikBrawlTT/brawl-calculadora/main/Brawlers/penny.png",
"https://raw.githubusercontent.com/ErikBrawlTT/brawl-calculadora/main/Brawlers/darryl.png",
"https://raw.githubusercontent.com/ErikBrawlTT/brawl-calculadora/main/Brawlers/rico.png",
"https://raw.githubusercontent.com/ErikBrawlTT/brawl-calculadora/main/Brawlers/mortis.png",
"https://raw.githubusercontent.com/ErikBrawlTT/brawl-calculadora/main/Brawlers/bea.png"
];
let current = 0;
const brawlerImg = document.getElementById("brawlerImg");
document.getElementById("centerDiamond").style.display="block";
setInterval(()=>{ current=(current+1)%brawlers.length; brawlerImg.src=brawlers[current];},3000);

// ---------------- Inicializar ----------------
initCounterRow().then(cargarContadores);
</script>
</body>
</html>
